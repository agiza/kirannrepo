#
# CHEF MANAGED FILE: DO NOT EDIT
# Generated by Chef for <%= node['hostname'] %>
# Controlling Cookbook: <%= @cookbook_name %>
#

[mysqld_safe]
log-error       = /u02/mysqldata/mysqllog/3306/err/mysqld_safe_error.log
nice            = 0

[mysqld]
basedir         = /usr
tmpdir          = /u02/mysqldata/tmp
skip-external-locking
skip-name-resolve

# * Charset and Collation
character-set-server    = utf8
collation-server        = utf8_general_ci
lower_case_table_names  = 1
event_scheduler         = 0
skip-character-set-client-handshake

# * Bind Address
<% if @bind_address -%>
bind-address        = <%= @bind_address %>
<% end -%>


# * Fine Tuning
max_allowed_packet      = 64M
max_connections         = 500
max_connect_errors      = 100

max_heap_table_size     = 256M
tmp_table_size          = 256M

net_buffer_length       = 8K
sort_buffer_size        = 20M
read_buffer_size        = 1M
read_rnd_buffer_size    = 2M
join_buffer_size        = 1M
key_buffer_size         = 512M

table_open_cache        = 2048
#table_cache            = 1024
table_definition_cache  = 512

thread_stack            = 256K
thread_cache_size       = 256

connect_timeout         = 10
wait_timeout            = 31536000
net_read_timeout        = 30
net_write_timeout       = 30
back_log                = 100
interactive-timeout     = 3600

bulk_insert_buffer_size = 32M
open-files-limit        = 1024
transaction-isolation   = READ-COMMITTED

# Default Table Settings - NO_AUTO_CREATE_USER
sql_mode                = NO_ENGINE_SUBSTITUTION

# * Query Cache Configuration
query_cache_type        = 0
query_cache_size        = 64M
query_cache_limit       = 4M

# * MyISAM Configuration
myisam-recover          = BACKUP
myisam_sort_buffer_size = 128M
ft_min_word_len         = 3
myisam_recover_options  = BACKUP,FORCE
myisam_repair_threads   = 6
myisam_use_mmap         = 1

# * General Logging

log_error               = /u02/mysqldata/mysqllog/3306/err/error.log

long_query_time         = 1
slow_query_log          = 1
slow_query_log_file     = /u02/mysqldata/mysqllog/3306/slow/mysql_slow.log

general_log             = 0
general_log_file        = /u02/mysqldata/mysqllog/3306/general/mysql_general.log

# Binary Log and Replication Configuration
#log_bin                 = /u02/mysqldata/mysqllog/3306/bin/mysql-bin.log
#log-bin-index           = /u02/mysqldata/mysqllog/3306/bin/mysql-bin.index
#binlog-cache-size       = 256K
#binlog_format           = ROW
#relay-log               = /u02/mysqldata/mysqllog/3306/relay/mysql-relay-bin.log
#relay-log-index         = /u02/mysqldata/mysqllog/3306/relay/mysql-relay-bin.index
relay_log_space_limit   = 16G
expire_logs_days        = 7
max_binlog_size         = 100M
binlog_cache_size       = 256K
sync_binlog             = 1

#binlog_do_db           = include_database_name
#binlog_ignore_db       = include_database_name
# replicate_do_db: Unset
# replicate_do_table: Unset
# replicate_ignore_db: Unset
# replicate_ignore_table: Unset
# replicate_wild_do_table: Unset
# replicate_wild_ignore_table: Unset
# skip_slave_start: Disabled
# read_only: Disabled


# binlog_do_db: Unset
# binlog_ignore_db: Unset

# * Replication
server_id                   = <%= @serverid %>
auto-increment-increment    = 10
auto-increment-offset       = <%= node['rf-iam-mysql']['auto-increment-offset'] %>
concurrent_insert           = 2
slave_transaction_retries   = 20
slave_compressed_protocol   = 0

log-slave-updates
#replicate-ignore-db        = mysql
#replicate-ignore-table     =
#slave-skip-errors          = 1062

# * InnoDB Configuration
# skip-innodb: Disabled
innodb                          = FORCE
innodb_file_format              = Barracuda
innodb_file_format_max          = Barracuda

innodb_data_home_dir            = /u02/mysqldata1/innodb/3306/data
innodb_log_group_home_dir       = /u02/mysqldata1/innodb/3306/log
innodb_file_per_table
innodb_data_file_path           = ibdata1:10M:autoextend
innodb_flush_log_at_trx_commit  = 0
innodb_table_locks              = true
innodb_lock_wait_timeout        = 60
innodb_thread_concurrency       = 2
innodb_commit_concurrency       = 2
innodb_support_xa               = true
innodb_buffer_pool_size         = 512M
innodb_log_buffer_size          = 8M
innodb_log_file_size            = 512M
innodb_additional_mem_pool_size = 128M
innodb_flush_method             = O_DSYNC
innodb-open-files               = 500
innodb-support-xa               = 0

# innodb_log_files_in_group: Unset
# innodb_status_file: Disabled
# skip-innodb-doublewrite: Disabled
# innodb_adaptive_flushing: Unset
# innodb_adaptive_flushing_method: Unset
# innodb_adaptive_checkpoint: Unset
# innodb_change_buffering: Unset
# innodb_doublewrite: Unset
# innodb_file_format: Unset

# * MySQL version (5.1) < 5.5 - following options are disabled:
# innodb_write_io_threads       = 4
# innodb_io_capacity            = 200
# innodb_read_io_threads        = 2
# innodb_buffer_pool_instances  = -274

# Extra Arguments
#character-set-client   = utf8
interactive_timeout     = 31536000
large-pages
thread_concurrency      = 8

# * SSL certificates - I recommend the OpenSSL GUI "tinyca".
# ssl-ca    =/etc/mysql/cacert.pem
# ssl-cert  =/etc/mysql/server-cert.pem
# ssl-key   =/etc/mysql/server-key.pem

[mysqldump]
quick
quote-names
max_allowed_packet = 128M

[mysql]
#no-auto-rehash # faster start of mysql but no tab completition

[myisamchk]
key_buffer                  = 512M
myisam_sort_buffer_size     = 128M
myisam_max_sort_file_size   = 2147483648
myisam_repair_threads       = 1
myisam-recover              = BACKUP

[isamchk]
key_buffer                  = 1G