# this config needs haproxy-1.1.28 or haproxy-1.2.1

global
#	log 127.0.0.1	local0
#	log 127.0.0.1	local1 notice
	log 127.0.0.1	alert
	log 127.0.0.1	alert debug
	#log loghost	local0 info
	maxconn 4096
	#chroot /usr/share/haproxy
	user haproxy
	group haproxy
	daemon
	#debug
	#quiet

defaults
	log	global
	mode	tcp
	option	tcplog
	option	dontlognull
	retries	3
	option redispatch
	maxconn	2000
	contimeout	5000
	clitimeout	50000
	srvtimeout	50000

listen rabbitmqdev <%= node:[ipaddress] %>:5100
	mode    tcp
	balance roundrobin
	option  tcpka
<% @clusternodes.each do |clusternode| -%>
	server  <%= clusternode %> <%= clusternode %>:5672 check inter 5000 downinter 500    
<% end -%>

listen rabbitmqqa <%= node:[ipaddress] %>:5200
        mode    tcp
        balance roundrobin
        option  tcpka
<% @clusternodes.each do |clusternode| -%>
        server  <%= clusternode %> <%= clusternode %>:5672 check inter 5000 downinter 500       
<% end -%>

listen rabbitmqdemo <%= node:[ipaddress] %>:5300
	mode	tcp
	balance	roundrobin
	option	tcpka
<% @clusternodes.each do |clusternode| -%>
        server  <%= clusternode %> <%= clusternode %>:5672 check inter 5000 downinter 500       
<% end -%>

