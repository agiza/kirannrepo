<?xml version='1.0' encoding='utf-8'?>
<Context>
    <% if @db[:type] == 'oracle' %>
    <Resource name="jdbc/strongmail"
            auth="Container"
            type="javax.sql.DataSource"
            driverClassName="oracle.jdbc.driver.OracleDriver"
            url="jdbc:oracle:thin:@<%= @db[:host] %>:<%= @db[:port] %>/<%= @db[:schema] %>"
            username="<%= @db_username %>" password="<%= @db_password %>"
            maxActive="10"
            minIdle="0"
            maxIdle="10"
            maxWait="6000"
            timeBetweenEvictionRunsMillis="60000"
            removeAbandoned="true"
            removeAbandonedTimeout="600"
            validationQuery= "SELECT 1 from dual"
            validationQueryTimeout="2"
            testOnBorrow="true"
            testWhileIdle="false"
            initialSize="2"/>
    <% else %>
    <Resource name="jdbc/strongmail"
            auth="Container"
            type="javax.sql.DataSource"
            driverClassName="com.mysql.jdbc.Driver"
            url="jdbc:mysql://<%= @db[:host] %>:<%= @db[:port] %>/<%= @db[:schema] %>?autoReconnect=true"
            username="<%= @db_username %>" password="<%= @db_password %>"
            maxActive="<%= @db[:max_active] %>"
            minIdle="0"
            maxIdle="<%= @db[:max_idle] %>"
            maxWait="<%= @db[:max_wait] %>"
            timeBetweenEvictionRunsMillis="<%= @db[:eviction_interval] %>"
            removeAbandoned="true"
            removeAbandonedTimeout="600"
            validationQuery= "SELECT 1"
            validationQueryTimeout="<%= @db[:validation_timeout] %>"
            testOnBorrow="true"
            testWhileIdle="false"
            initialSize="<%= @db[:initial_size] %>"/>
    <% end %>
</Context>
