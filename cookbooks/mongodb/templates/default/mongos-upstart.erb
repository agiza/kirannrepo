description "upstart init for a mongos instance"
author      "JSM: stanky"

# used to be: start on startup
start on started mountall
stop on shutdown

# Automatically Respawn:
respawn
respawn limit 99 5

pre-start script
 # JSM: porting from older init.d script setup
 CONFIGFILE="/etc/mongos.conf"
 OPTIONS=" -f $CONFIGFILE"
 SYSCONFIG="/etc/sysconfig/mongod"
 PID_PATH=/var/run/mongo
 PID_FILE=${PID_PATH}/mongos.pid
 MONGO_BIN=/usr/bin/mongos
 MONGO_ULIMIT=12000
 MONGO_LOCK_FILE=/var/lock/subsys/mongos
 MONGO_USER=mongod
 MONGO_GROUP=mongod
 RETVAL=0
 ulimit -n $MONGO_ULIMIT
 echo -n $"Starting mongos: "
    daemon --user "$MONGO_USER" --pidfile $PID_FILE $MONGO_BIN $OPTIONS --pidfilepath=$PID_FILE
      RETVAL=$?
          [ $RETVAL -eq 0 ] && touch $MONGO_LOCK_FILE
end script

post-start script
 RETVAL=0
 echo -n $"Stopping mongos: "
 killproc -p $PID_FILE -t30 -TERM $MONGO_BIN
   RETVAL=$?
   [ $RETVAL -eq 0 ] && rm -f $MONGO_LOCK_FILE
   [ $RETVAL -eq 0 ] && rm -f $PID_FILE
end script

